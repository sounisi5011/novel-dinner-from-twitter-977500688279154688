//- http://ogp.me/

-
  const prefixValueList = [];

  if (ogp && ogp.type && ogp.title && ogp.url && ogp.imageUrl) {
    prefixValueList.push('og: http://ogp.me/ns#');

    if (/^(?:music|video|article|book|profile|website)$/.test(ogp.type)) {
      prefixValueList.push(`${ogp.type}: http://ogp.me/ns/${ogp.type}#`);
    }
  }

  const useOgp = 0 < prefixValueList.length;

head(prefix=(useOgp ? prefixValueList.join(' ') : false))
  meta(charset="utf-8")
  meta(name="viewport" content="width=device-width,initial-scale=1")
  meta(name="format-detection" content="telephone=no,email=no,address=no")

  if author
    meta(name="author" content=author)

  if description
    meta(name="description" content=description)

  if copyright && author
    meta(name="copyright" content=(
      creationDate ?
      `© ${formatDate(creationDate, '%Y')}-${formatDate(generateTime, '%Y')} ${author}` :
      `© ${formatDate(generateTime, '%Y')} ${author}`
    ))

  if generateTime
    meta(
      name="date"
      content=formatDate(generateTime, '%Y-%m-%dT%H:%M:%SZ', 0)
    )

  if creationDate
    meta(
      name="creation_date"
      content=formatDate(creationDate, '%Y-%m-%dT%H:%M:%SZ', 0)
    )

  //- https://www.metatags.org/meta_name_rating
  //- http://wa3.i-3-i.info/word11817.html
  //- http://webmarketingnow.com/tips/web/meta-tags/#rating
  //- if /^(?:general|child|adult|safe for kids|mature|restricted|14 years)$/.test(rating)
  //-   meta(name='rating' content=rating)

  if themeColor
    meta(name="theme-color" content=themeColor)

  title
    | #{title}
    if author
      | #{s}by #{author}

  if baseUrl
    link(rel="canonical" href=baseUrl)

  if authorUrl
    link(rel="author" href=authorUrl)

  if publisherUrl
    link(rel="publisher" href=publisherUrl)

  if linkMeUrl
    -
      const linkMeUrlList = (
        Array.isArray(linkMeUrl) ?
        linkMeUrl :
        [linkMeUrl]
      );
    each url in linkMeUrlList
      link(rel="me" href=url)

  if licenseUrl
    link(rel="license" href=licenseUrl)

  if shortlink
    link(rel="shortlink" href=shortlink)

  //- http://ogp.me/

  if useOgp
    meta(property="og:title" content=ogp.title)
    meta(property="og:type" content=ogp.type)
    meta(property="og:url" content=ogp.url)
    meta(property="og:image" content=ogp.imageUrl)

    if ogp.imageSecureUrl
      meta(property="og:image:secure_url" content=ogp.imageSecureUrl)

    if ogp.imageType
      meta(property="og:image:type" content=ogp.imageType)

    if ogp.imageWidth
      meta(property="og:image:width" content=ogp.imageWidth)

    if ogp.imageHeight
      meta(property="og:image:height" content=ogp.imageHeight)

    if ogp.imageAlt
      meta(property="og:image:alt" content=ogp.imageAlt)

    if ogp.locale
      -
        const localeList = (
          Array.isArray(ogp.locale) ?
          ogp.locale :
          [ogp.locale]
        );
      each localeValue in localeList
        if index === 0
          meta(property="og:locale" content=localeValue)
        else
          meta(property="og:locale:alternate" content=localeValue)

    if ogp.siteName
      meta(property="og:site_name" content=ogp.siteName)

    if ogp.determiner
      meta(property="og:determiner" content=ogp.determiner)

    if ogp.description
      meta(property="og:description" content=ogp.description)

    if ogp.type === 'article'
      if ogp.publishedTime || creationDate
        meta(
          property="article:published_time"
          content=formatDate(ogp.publishedTime || creationDate, '%Y-%m-%dT%H:%M:%SZ', 0)
        )

      if ogp.modifiedTime || generateTime
        meta(
          property="article:modified_time"
          content=formatDate(ogp.modifiedTime || generateTime, '%Y-%m-%dT%H:%M:%SZ', 0)
        )

      if ogp.expirationTime
        meta(
          property="article:expiration_time"
          content=formatDate(ogp.expirationTime, '%Y-%m-%dT%H:%M:%SZ', 0)
        )

      if ogp.articleAuthor
        -
          const articleAuthorList = (
            Array.isArray(ogp.articleAuthor) ?
            ogp.articleAuthor :
            [ogp.articleAuthor]
          );
        each authorValue in articleAuthorList
          meta(property="article:author" content=authorValue)

    if ogp.fb
      if ogp.fb.appId
        meta(
          prefix="fb: http://ogp.me/ns/fb#"
          property="fb:app_id" content=ogp.fb.appId
        )

    //- https://developer.twitter.com/en/docs/tweets/optimize-with-cards/guides/getting-started

    if ogp.twitter && ogp.twitter.card
      meta(name="twitter:card" content=ogp.twitter.card)

      if ogp.twitter.site
        - assertTwitterId('ogp.twitter.site', ogp.twitter.site)
        meta(name="twitter:site" content=ogp.twitter.site)

      if ogp.twitter.id
        - assertTwitterId('ogp.twitter.id', ogp.twitter.id)
        meta(name="twitter:site:id" content=ogp.twitter.id)

      if ogp.twitter.creator
        - assertTwitterId('ogp.twitter.creator', ogp.twitter.creator)
        meta(name="twitter:creator" content=ogp.twitter.creator)

      if ogp.twitter.creatorId
        meta(name="twitter:creator:id" content=ogp.twitter.creatorId)

      if ogp.twitter.title
        - assertStringLength('ogp.twitter.title', ogp.twitter.title, 70)
      else
        - assertStringLength('ogp.title', ogp.title, 70)
        - ogp.twitter.title = ogp.title

      meta(name="twitter:title" content=ogp.twitter.title)

      if ogp.twitter.description
        - assertStringLength('ogp.twitter.description', ogp.twitter.description, 200)
        meta(name="twitter:description" content=ogp.twitter.description)

      if ogp.twitter.imageUrl
        meta(name="twitter:image" content=ogp.twitter.imageUrl)

      if ogp.twitter.imageAlt
        - assertStringLength('ogp.twitter.imageAlt', ogp.twitter.imageAlt, 420)
        meta(name="twitter:image:alt" content=ogp.twitter.imageAlt)

  if includeResources && Array.isArray(includeResources)
    -
      // https://w3c.github.io/webappsec-subresource-integrity/#the-integrity-attribute
      // https://www.w3.org/TR/CSP2/#source-list-syntax
      // Note: hash_algoの正規表現パターンは、2018/03/28現在のものです。
      //       将来、ブラウザは新しいハッシュアルゴリズムを導入する可能性があります。
      //       その場合、新しいハッシュアルゴリズムの導入に合わせてパターンを改良する必要があります。
      const integrityRegex = (() => {
        const vchar = String.raw`[\u0021-\u007E]`;
        const wsp = String.raw`[\u0020\u0009]`;

        const hash_algo = String.raw`(?:[A-Za-z0-9]+)`;
        const base64_value = String.raw`(?:(?:[A-Za-z0-9+/]{4})*(?:[A-Za-z0-9+/]===|[A-Za-z0-9+/]{2}==|[A-Za-z0-9+/]{3}=|[A-Za-z0-9+/]{4}))`;

        const hash_expression = String.raw`(?:${hash_algo}-${base64_value})`;
        const option_expression = String.raw`(?:${vchar}*)`;
        const hash_with_options = String.raw`(?:${hash_expression}(?:\?${option_expression})*)`;
        const integrity_metadata = String.raw`(?:${wsp}*${hash_with_options}(?:${wsp}+${hash_with_options})*${wsp}*|${wsp}*)`;

        return new RegExp(`^${integrity_metadata}$`);
      })();
      const preloadList = [];
      
    each resource in includeResources
      if resource
        -
          const resourceData = (
            typeof resource === 'string' ?
            {src: resource} :
            resource
          );
          const srcPath = resourceData.src || resourceData.href;
          const srcExtension = (/^[^?]+\.([a-z]+)(?:$|\?)/.exec(srcPath) || [, ''])[1];
          const integrityValue = (
            (
              resourceData.integrity &&
              integrityRegex.test(resourceData.integrity)
            ) ?
            resourceData.integrity :
            false
          );

        if srcExtension === 'css'
          link(
            rel=((resourceData.alternate && resourceData.title) ? 'alternate stylesheet' : 'stylesheet')
            href=srcPath
            type=(resourceData.type || false)
            media=(resourceData.media || false)
            title=(resourceData.title || false)
            crossorigin=(resourceData.crossorigin || false)
            integrity=integrityValue
            referrerpolicy=(resourceData.referrerpolicy || false)
            id=(resourceData.id || false)
          )

        else if resourceData.include === 'head' && srcExtension === 'js'
          script(
            src=srcPath
            type=(resourceData.type || false)
            async=Boolean(resourceData.async)
            defer=Boolean(resourceData.defer)
            crossorigin=(resourceData.crossorigin || false)
            integrity=integrityValue
            id=(resourceData.id || false)
          )
